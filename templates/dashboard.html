<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Stato Lavanderia</title>

    <style>
        body {
            font-family: Arial;
            background: #f4f4f4;
            padding: 20px;
        }

        h1 {
            margin-bottom: 20px;
        }

        .machine {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 6px;
            background: #eaeaea;
        }

        .label {
            margin-left: 10px;
            font-size: 16px;
        }

        .led {
            width: 18px;
            height: 18px;
            border-radius: 50%;
        }

        /* Stati */
        .idle {
            background: #2ecc71; /* verde */
        }

        .running {
            background: orange;
            animation: blink 1s infinite;
        }

        .locked {
            background: red;
        }

        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
        }
    </style>
</head>

<body>

<h1>Stato macchine lavanderia</h1>

<div id="machines"></div>

<script>
async function loadStatus() {
    const res = await fetch("/status");
    const data = await res.json();

    let html = "";

    for (const location in data) {
        html += `<h2>${location}</h2>`;

        for (const machine in data[location]) {
            const state = data[location][machine].status || "idle";

            html += `
                <div class="machine">
                    <div class="led ${state}"></div>
                    <div class="label">${machine} â€” ${state}</div>
                </div>
            `;
        }
    }

    document.getElementById("machines").innerHTML = html;
}

setInterval(loadStatus, 1000);
loadStatus();
</script>

</body>
</html>
